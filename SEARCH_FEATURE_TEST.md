# 날짜 범위 검색 & 정렬 기능 테스트 가이드

## 🔧 수정 사항 (2025-12-22)

### 1. 프론트엔드 수정
- ✅ 종료 날짜를 23:59:59로 자동 설정 (기존: 00:00:00)
- ✅ 디버깅 로그 추가 (콘솔에서 확인 가능)
- ✅ RFC 3339 형식 날짜 변환 개선

### 2. 백엔드 수정
- ✅ search() API 사용 시 디버깅 로그 추가
- ✅ 날짜 범위 및 정렬 파라미터 전달 확인
- ✅ relevanceLanguage 파라미터 제거 (오류 방지)

## 🚀 테스트 방법

### 1. 서버 재시작

**백엔드 재시작:**
```bash
cd backend
# 기존 서버 종료 (Ctrl+C)
python main.py
```

**프론트엔드 재시작:**
```bash
cd frontend
# 기존 서버 종료 (Ctrl+C)
npm run dev
```

### 2. 테스트 시나리오

#### 시나리오 1: 날짜 범위 검색 (트렌딩)
1. 브라우저에서 `http://localhost:3000/search` 접속
2. 트렌딩 탭 선택
3. 설정:
   - 지역: 미국
   - 카테고리: Science & Technology
   - 정렬: **최신 날짜**
   - 시작 날짜: `2024-12-01`
   - 종료 날짜: `2024-12-22`
4. "트렌딩 영상 검색" 클릭
5. **확인사항:**
   - 브라우저 콘솔에 `[FRONTEND] 트렌딩 검색 요청:` 로그 확인
   - `published_before`가 `2024-12-22T23:59:59.999Z` 형식인지 확인
   - 백엔드 터미널에 `[DEBUG] search() API 사용` 로그 확인
   - 검색 결과가 2024년 12월 영상만 나오는지 확인

#### 시나리오 2: 정렬 기능 (조회수)
1. 트렌딩 탭에서:
   - 정렬: **조회수**
   - 날짜 범위: 설정 안 함
2. 검색
3. **확인사항:**
   - 백엔드 터미널에 `[DEBUG] API에서 N개 영상 받음 (trending)` 확인 (search가 아닌 trending)
   - 결과가 조회수 높은 순으로 정렬되어 있는지 확인

#### 시나리오 3: 정렬 기능 (날짜)
1. 트렌딩 탭에서:
   - 정렬: **최신 날짜**
   - 날짜 범위: 설정 안 함
2. 검색
3. **확인사항:**
   - 백엔드 터미널에 `[DEBUG] search() API 사용 - order: date` 확인
   - 최근 영상이 먼저 나오는지 확인

#### 시나리오 4: 키워드 검색 + 날짜 범위
1. 키워드 탭 선택
2. 설정:
   - 키워드: `AI technology`
   - 정렬: 조회수
   - 시작 날짜: `2024-01-01`
   - 종료 날짜: `2024-12-31`
3. 검색
4. **확인사항:**
   - 2024년에 업로드된 AI 관련 영상만 나오는지 확인
   - 조회수 높은 순으로 정렬되어 있는지 확인

## 🐛 예상되는 문제 및 해결

### 문제 1: 날짜 범위 검색이 작동하지 않음
**증상:** 날짜를 설정해도 모든 영상이 나옴

**확인:**
1. 브라우저 콘솔에서 `published_after`, `published_before` 값 확인
2. 백엔드 터미널에서 `[DEBUG] search() 파라미터:` 로그 확인
3. `publishedAfter`, `publishedBefore` 키가 있는지 확인

**해결:**
- 프론트엔드가 제대로 재시작되었는지 확인
- 캐시 삭제 후 페이지 새로고침 (Ctrl+Shift+R)

### 문제 2: 정렬이 작동하지 않음
**증상:** 정렬을 바꿔도 결과가 동일함

**확인:**
1. 백엔드 로그에서 `order:` 값 확인
2. `search()` API가 사용되는지 확인 (trending이 아닌)

**원인:**
- 트렌딩 검색에서 `order: viewCount`일 때는 `videos().list()` 사용 (정렬 불가)
- 다른 정렬 옵션을 선택하면 `search()` 사용 (정렬 가능)

**해결:**
- 날짜 순 정렬을 원하면 "최신 날짜" 선택
- 평점 순 정렬을 원하면 "평점" 선택

### 문제 3: YouTube API 오류
**증상:** 500 에러 또는 검색 결과 없음

**확인:**
1. `.env` 파일에 `YOUTUBE_API_KEY` 설정되어 있는지 확인
2. API 키가 유효한지 확인
3. YouTube Data API v3 할당량 확인 (하루 10,000 유닛)

## 📝 YouTube API 동작 방식

### 트렌딩 검색 (videos().list)
- ✅ 조회수 순 정렬 (기본)
- ❌ 날짜 범위 지원 안 함
- ❌ 다른 정렬 옵션 지원 안 함

### 일반 검색 (search().list)
- ✅ 날짜 범위 지원
- ✅ 정렬 옵션 지원 (date, rating, relevance, viewCount)
- ℹ️ 트렌딩 영상이 아닌 일반 검색 결과

### 현재 구현 로직
```
if (날짜 범위 설정 OR 정렬 != 조회수):
    → search() API 사용 (일반 검색)
else:
    → videos().list() 사용 (트렌딩)
```

## ✅ 성공 기준

모든 시나리오에서:
1. 검색 결과가 나옴 (빈 결과가 아님)
2. 설정한 날짜 범위 내의 영상만 표시됨
3. 선택한 정렬 기준대로 결과가 정렬됨
4. 콘솔/터미널에 디버깅 로그가 표시됨

## 🔍 디버깅 로그 예시

**프론트엔드 (브라우저 콘솔):**
```
[FRONTEND] 트렌딩 검색 요청: {
  region: "US",
  category: "Science & Technology",
  order: "date",
  published_after: "2024-12-01T00:00:00.000Z",
  published_before: "2024-12-22T23:59:59.999Z",
  ...
}
```

**백엔드 (터미널):**
```
[SEARCH] 트렌딩 검색 요청:
  - region: US
  - category: Science & Technology
  - order: date
  - published_after: 2024-12-01T00:00:00.000Z
  - published_before: 2024-12-22T23:59:59.999Z

[DEBUG] search() API 사용 - order: date, after: 2024-12-01T00:00:00.000Z, before: 2024-12-22T23:59:59.999Z
[DEBUG] search() 파라미터: {'part': 'id', 'type': 'video', ...}
[DEBUG] search() 응답 items 수: 20
[DEBUG] API에서 20개 영상 받음 (search)
[OK] 10개 영상 발견
```

## 📞 문제 보고

테스트 중 문제가 발생하면:
1. 브라우저 콘솔 로그 캡처
2. 백엔드 터미널 로그 캡처
3. 사용한 검색 조건 기록
4. 예상 결과 vs 실제 결과 비교

---

**마지막 업데이트:** 2025-12-22
